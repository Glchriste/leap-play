<!DOCTYPE html>
<meta charset="utf-8">
<title>Realtime Diagnostics</title>
<style>
body {
  width: 980px;
  margin: 20px auto;
}
</style>
<script src="js/lib/d3.v3.js"></script>
<script src="js/lib/leap.js"></script>
<canvas id="fingers" height=500 width=980></canvas>
<p>
  Dots - X/Y position<br/>
  Dot Size - Distance from [0,*,0] (doesn't use Y position)<br/>
  Gray bars - Pointable length<br/>
  Numbers - Pointable id
</p>
<script>
var center = [0,170,0];

// connect leap motion
var controller = new Leap.Controller();
controller.connect();
controller.onFrame(function() {
  var obj = controller.frame();
  fingers(obj.pointables);
});

// finger lengths
var fingersCanvas = document.getElementById("fingers");
var fingersctx = fingersCanvas.getContext("2d");
var x = d3.scale.linear().range([0,fingersCanvas.width]).domain([-200,200]);
var y = d3.scale.linear().range([fingersCanvas.height,0]).domain([0,400]);
fingersctx.textAlign = "center";
fingersctx.textBaseline = "bottom";
fingersctx.font = "13pt sans-serif";
function fingers(pointables) {
  var w = fingersCanvas.width;
  var h = fingersCanvas.height;
  fingersctx.clearRect(0,0,w,h);
  fingersctx.fillStyle = "rgba(0,0,0,0.4)";
  pointables.map(function(p) {
    fingersctx.fillRect(x(p.tipPosition[0]),h,4,-p.length);
  });
  fingersctx.fillStyle = "rgba(0,0,0,0.8)";
  pointables.map(function(p) {
    var pos = p.tipPosition;
    var dist = 900/Math.sqrt( Math.pow(pos[0]-center[0], 2) + 
                            Math.pow(pos[2]-center[2], 2) + 0.00001 );
    var r = d3.min([dist, 30]);
    fingersctx.fillRect(x(pos[0])-r/2, y(pos[1])-r/2, r, r);
    fingersctx.fillText(p.id, x(pos[0]), y(pos[1]) - r);
  });
};
</script>
